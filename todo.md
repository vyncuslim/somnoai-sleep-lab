# SomnoAI Digital Sleep Lab - 开发任务清单

## 核心功能模块

### 用户认证系统
- [x] 邮箱/密码注册界面
- [x] 邮箱/密码登录界面
- [x] Google OAuth 集成（自定义页面，使用 GOOGLE_CLIENT_ID/SECRET）
- [x] 会话管理与登出功能
- [x] 用户信息管理
- [x] 自定义登录页面（不使用默认 Manus 登录）

### Dashboard 首页
- [x] 圆环进度条显示睡眠评分
- [x] 网格卡片展示关键指标（总时长、深睡比、REM 比、睡眠效率）
- [x] 睡眠阶段折线图（深睡、浅睡、REM、清醒）
- [x] 心率监测卡片（平均、最低、最高 BPM）
- [x] 本周趋势柱状图
- [x] AI 睡眠洞察列表
- [x] Google Fit 同步卡片
- [x] 步速和卡路里数据

### 手动数据录入
- [x] 手动录入页面（睡眠时间、质量评分、心率）
- [x] 数据验证和保存
- [ ] 批量导入 CSV 功能
- [ ] 编辑和删除已录入数据

### Google Fit 集成
- [x] Google OAuth 认证流程
- [x] 获取睡眠段数据（服务已创建）
- [x] 获取心率数据（服务已创建）
- [x] 同步状态提示（UI 组件已创建）
- [ ] 定时自动同步（后台任务）
- [ ] 错误处理与重试机制

### 趋势分析页面
- [x] 周维度分析视图（7 天数据）
- [x] 月维度分析视图（30 天数据）
- [x] 年维度分析视图（12 个月数据）
- [x] 睡眠评分波动曲线
- [x] 睡眠时长波动曲线
- [x] 深睡比例波动曲线
- [ ] 对比分析工具

### 睡眠日历
- [x] 日历页面创建
- [x] 历史记录查询
- [x] 日期详情页面
- [ ] 数据回溯分析

### 闹钟与通知
- [ ] 闹钟设置界面
- [ ] 智能唤醒功能
- [x] 通知中心
- [ ] 系统偏好设置

### 导航系统
- [x] 首页导航
- [x] 日历导航
- [x] AI 助手导航
- [ ] 闹钟导航
- [ ] 我的（用户中心）导航

## UI/UX 设计
- [x] 深蓝/靛蓝渐变背景
- [x] 毛玻璃效果（Glassmorphism）
- [x] 青色与金色高光
- [x] 流畅入场动画
- [ ] 微交互效果
- [x] 华文界面本地化

## 测试与部署
- [ ] 单元测试编写（API 路由）
- [ ] 集成测试（Google Fit 同步）
- [ ] UI 测试
- [ ] 性能优化
- [x] 部署配置（Manus 托管）

### 自定义通知系统
- [x] 通知数据库模型
- [x] 通知创建与管理 API
- [x] 通知中心页面
- [x] 通知徽章组件
- [x] 通知钩子（useNotifications）
- [ ] 实时通知推送
- [ ] 通知类型配置（睡眠提醒、心率异常、目标达成等）

### 真实法律文件
- [x] 完整的隐私政策（包含数据收集、使用、保护等详细内容）
- [x] 完整的服务条款（包含使用条件、责任限制、用户义务等）

### AI 聊天助手增强
- [x] AI 助手页面创建
- [ ] Gemini API Key 输入界面
- [ ] API Key 安全存储
- [ ] 聊天界面完善
- [ ] 基于睡眠数据的个性化建议
- [ ] 消息历史记录管理


## 新增功能 - AI 聊天助手与 Google Fit 集成

### AI 聊天助手增强
- [ ] 添加 Gemini API Key 输入界面到 AI 助手页面
- [ ] API Key 安全存储在用户偏好设置
- [ ] 实现多轮对话聊天界面
- [ ] 基于睡眠数据的个性化建议生成
- [ ] 聊天历史记录保存和显示

### Google Fit 真实数据集成
- [ ] Dashboard 中添加"连接 Google Fit"按钮
- [ ] 实现 Google Fit OAuth 授权流程
- [ ] 获取用户最近 7 天的睡眠数据
- [ ] 获取用户最近 7 天的心率数据
- [ ] 获取用户最近 7 天的步数和卡路里数据
- [ ] 将真实数据展示在 Dashboard 上
- [ ] 添加同步状态指示器和手动刷新按钮

### Gemini API 集成
- [ ] 创建后端 API 路由处理 Gemini 请求
- [ ] 基于睡眠数据生成个性化改善建议
- [ ] 实现流式响应处理
- [ ] 错误处理和重试机制


## 新增功能 - Google Fit 同步状态反馈系统

### 数据库扩展
- [x] 添加 googleFitSyncStatus 表用于追踪同步状态
- [x] 记录同步开始时间、结束时间、状态、错误信息

### 后端 API 增强
- [x] 创建 getStatus 端点获取当前同步状态
- [x] 创建 getSyncHistory 端点获取同步历史
- [ ] 实现同步进度追踪和错误日志记录
- [ ] 添加同步超时处理和重试機制

### 前端 UI 改进
- [x] 创建 GoogleFitSyncEnhanced 组件显示详细的同步状态
- [x] 添加同步进度条和百分比显示
- [x] 实现同步状态轮询（每 2 秒更新一次）
- [x] 添加"正在同步"、"同步成功"、"同步失败"的视覺反馈
- [x] 显示最后同步时间和同步耗时

### 错误处理与提示
- [x] 显示具体的错误信息（如网络错误、权限不足等）
- [x] 添加同步历史记录显示
- [ ] 提供重试按黮u和故障排查建议

### 隐私政策更新
- [x] 更新隐私政策以包含 Google Fit 数据处理的详细信息
- [x] 添加数据授权、使用限制、安全与断开连接的章节

### 测试
- [ ] 编写单元测试验证同步状态逻辑
- [ ] 测试不同的同步场景（成功、失败、超时等）
